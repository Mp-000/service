<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Smart Decision Support System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#f8f9fa }
.sidebar { background:#0d6efd; color:white; min-height:100vh }
.sidebar h5 { padding:15px }
.card { margin-bottom:15px }
textarea { resize:none }
</style>
</head>

<body>
<div class="container-fluid">
<div class="row">

<!-- SIDEBAR -->
<div class="col-md-2 sidebar">
<h5>ðŸ“Š SPK Enterprise</h5>
<ul class="nav flex-column px-2">
<li class="nav-item">â€¢ Data Kriteria</li>
<li class="nav-item">â€¢ Data Alternatif</li>
<li class="nav-item">â€¢ Matriks Nilai</li>
<li class="nav-item">â€¢ Keputusan</li>
<li class="nav-item">â€¢ AI Copilot</li>
</ul>
</div>

<!-- MAIN -->
<div class="col-md-10 p-4">

<h4>Smart Decision Support System (SPSS-Like)</h4>
<hr>

<!-- KRITERIA -->
<div class="card">
<div class="card-header">Master Kriteria</div>
<div class="card-body row g-2">
<div class="col"><input id="kNama" class="form-control" placeholder="Nama"></div>
<div class="col"><input id="kBobot" type="number" step="0.01" class="form-control" placeholder="Bobot"></div>
<div class="col">
<select id="kTipe" class="form-select">
<option value="benefit">Benefit</option>
<option value="cost">Cost</option>
</select>
</div>
<div class="col">
<button class="btn btn-primary w-100" onclick="addKriteria()">Tambah</button>
</div>
</div>
<div class="card-body">
<ul id="listKriteria"></ul>
</div>
</div>

<!-- ALTERNATIF -->
<div class="card">
<div class="card-header">Master Alternatif</div>
<div class="card-body row g-2">
<div class="col"><input id="aNama" class="form-control" placeholder="Nama Alternatif"></div>
<div class="col">
<button class="btn btn-primary w-100" onclick="addAlternatif()">Tambah</button>
</div>
</div>
<div class="card-body">
<ul id="listAlternatif"></ul>
</div>
</div>

<!-- MATRIX -->
<div class="card">
<div class="card-header">Matriks Nilai (SPSS Data View)</div>
<div class="card-body" id="matrix"></div>
</div>

<!-- ACTION -->
<button class="btn btn-success" onclick="hitungSAW()">Hitung Keputusan</button>

<!-- HASIL -->
<div class="card mt-3">
<div class="card-header">Hasil Keputusan</div>
<div class="card-body" id="hasil"></div>
<canvas id="chart"></canvas>
</div>

<!-- AI -->
<div class="card mt-3 border-success">
<div class="card-header bg-success text-white">ðŸ¤– AI Copilot</div>
<div class="card-body" id="ai"></div>
</div>

</div>
</div>
</div>

<script>
/* ================= DATABASE ================= */
const dbGet = k => JSON.parse(localStorage.getItem(k)) || [];
const dbSet = (k,v) => localStorage.setItem(k,JSON.stringify(v));
["kriteria","alternatif","nilai","hasil"].forEach(k=>{ if(!localStorage.getItem(k)) dbSet(k,[]) });

/* ================= KRITERIA ================= */
function addKriteria(){
 let k=dbGet("kriteria");
 k.push({id:Date.now(),nama:kNama.value,bobot:+kBobot.value,tipe:kTipe.value});
 dbSet("kriteria",k); render();
}

/* ================= ALTERNATIF ================= */
function addAlternatif(){
 let a=dbGet("alternatif");
 a.push({id:Date.now(),nama:aNama.value});
 dbSet("alternatif",a); render();
}

/* ================= NILAI ================= */
function setNilai(a,k,v){
 let n=dbGet("nilai").filter(x=>!(x.a==a&&x.k==k));
 n.push({a,k,v:+v});
 dbSet("nilai",n);
}

/* ================= SAW ================= */
function hitungSAW(){
 let k=dbGet("kriteria"), a=dbGet("alternatif"), n=dbGet("nilai");
 let hasil=[];
 a.forEach(al=>{
  let skor=0;
  k.forEach(kr=>{
   let data=n.filter(x=>x.k==kr.id);
   let val=n.find(x=>x.a==al.id&&x.k==kr.id);
   if(!val) return;
   let max=Math.max(...data.map(x=>x.v));
   let min=Math.min(...data.map(x=>x.v));
   let norm=kr.tipe=="benefit"?val.v/max:min/val.v;
   skor+=norm*kr.bobot;
  });
  hasil.push({nama:al.nama,skor:+skor.toFixed(4)});
 });
 hasil.sort((x,y)=>y.skor-x.skor);
 dbSet("hasil",hasil);
 renderHasil();
 renderAI();
 renderChart();
}

/* ================= RENDER ================= */
function render(){
 listKriteria.innerHTML=dbGet("kriteria").map(x=>`<li>${x.nama} (${x.bobot})</li>`).join("");
 listAlternatif.innerHTML=dbGet("alternatif").map(x=>`<li>${x.nama}</li>`).join("");
 renderMatrix();
}

function renderMatrix(){
 let k=dbGet("kriteria"), a=dbGet("alternatif");
 let html="<table class='table table-sm table-bordered'><tr><th>Alternatif</th>";
 k.forEach(x=>html+=`<th>${x.nama}</th>`);
 html+="</tr>";
 a.forEach(al=>{
  html+=`<tr><td>${al.nama}</td>`;
  k.forEach(kr=>{
   html+=`<td><input type='number' class='form-control form-control-sm'
   onchange='setNilai(${al.id},${kr.id},this.value)'></td>`;
  });
  html+="</tr>";
 });
 html+="</table>";
 matrix.innerHTML=html;
}

function renderHasil(){
 let h=dbGet("hasil");
 hasil.innerHTML="<table class='table'><tr><th>Rank</th><th>Alternatif</th><th>Skor</th></tr>"+
 h.map((x,i)=>`<tr><td>${i+1}</td><td>${x.nama}</td><td>${x.skor}</td></tr>`).join("")+
 "</table>";
}

/* ================= CHART ================= */
function renderChart(){
 let h=dbGet("hasil");
 new Chart(chart,{
  type:"bar",
  data:{labels:h.map(x=>x.nama),datasets:[{label:"Skor",data:h.map(x=>x.skor)}]}
 });
}

/* ================= AI COPILOT ================= */
function renderAI(){
 let h=dbGet("hasil");
 if(!h.length){ ai.innerHTML="Belum ada hasil."; return;}
 let top=h[0];
 ai.innerHTML=`
<b>Kesimpulan AI</b><br>
Alternatif terbaik adalah <b>${top.nama}</b> dengan skor <b>${top.skor}</b>.<br><br>
AI merekomendasikan alternatif ini karena memiliki nilai agregat tertinggi
berdasarkan bobot kriteria yang ditentukan.
`;
}

render();
</script>
</body>
</html>
